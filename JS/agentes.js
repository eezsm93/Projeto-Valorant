var myJson = `{
  "data": {
    "agents": [
      {
        "name": "Jett",
        "function": "Duelista",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 5
          },
          {
            "type": 2,
            "damage": 8
          },
          {
            "type": 3,
            "damage": 10
          },
          {
            "type": 4,
            "damage": 30
          }
        ],
        "image": "./agents/jett.png"
      },
      {
        "name": "Raze",
        "function": "Sentinela",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 6
          },
          {
            "type": 2,
            "damage": 3
          },
          {
            "type": 3,
            "damage": 13
          },
          {
            "type": 4,
            "damage": 25
          }
        ],
        "image": "./agents/raze.png"
      },
      {
        "name": "Breach",
        "function": "Duelista",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 5
          },
          {
            "type": 2,
            "damage": 8
          },
          {
            "type": 3,
            "damage": 15
          },
          {
            "type": 4,
            "damage": 10
          }
        ],
        "image": "./agents/breach.png"
      },
      {
        "name": "Omen",
        "function": "Controlador",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 9
          },
          {
            "type": 2,
            "damage": 5
          },
          {
            "type": 3,
            "damage": 10
          },
          {
            "type": 4,
            "damage": 20
          }
        ],
        "image": "./agents/omen.png"
      },
      {
        "name": "Brimstone",
        "function": "Iniciador",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 5
          },
          {
            "type": 2,
            "damage": 5
          },
          {
            "type": 3,
            "damage": 10
          },
          {
            "type": 4,
            "damage": 20
          }
        ],
        "image": "./agents/brimstone.png"
      },
      {
        "name": "Phoenix",
        "function": "Duelista",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 15
          },
          {
            "type": 2,
            "damage": 8
          },
          {
            "type": 3,
            "damage": 10
          },
          {
            "type": 4,
            "damage": 30
          }
        ],
        "image": "./agents/phoenix.png"
      },
      {
        "name": "Sage",
        "function": "Iniciador",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 25
          },
          {
            "type": 2,
            "damage": 4
          },
          {
            "type": 3,
            "damage": 15
          },
          {
            "type": 4,
            "damage": 25
          }
        ],
        "image": "./agents/sage.png"
      },
      {
        "name": "Sova",
        "function": "Duelista",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 5
          },
          {
            "type": 2,
            "damage": 10
          },
          {
            "type": 3,
            "damage": 10
          },
          {
            "type": 4,
            "damage": 40
          }
        ],
        "image": "./agents/sova.png"
      },
      {
        "name": "Viper",
        "function": "Duelista",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 12
          },
          {
            "type": 2,
            "damage": 18
          },
          {
            "type": 3,
            "damage": 20
          },
          {
            "type": 4,
            "damage": 15
          }
        ],
        "image": "./agents/viper.png"
      },
      {
        "name": "Cypher",
        "function": "Controlador",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 10
          },
          {
            "type": 2,
            "damage": 15
          },
          {
            "type": 3,
            "damage": 10
          },
          {
            "type": 4,
            "damage": 20
          }
        ],
        "image": "./agents/cypher.png"
      },
      {
        "name": "Reyna",
        "function": "Iniciador",
        "description": "Devonshire rex. Devonshire rex birman but sphynx savannah panther lynx british shorthair. Tiger. Burmese british shorthair savannah but ocicat siamese for norwegian forest. American shorthair cornish rex american bobtail puma sphynx. Tabby munchkin savannah turkish angora, siamese yet tabby. Siberian grimalkin, birman so lynx but abyssinian tomcat. Ocicat scottish fold but devonshire rex.",
        "skills": [
          {
            "type": 1,
            "damage": 14
          },
          {
            "type": 2,
            "damage": 18
          },
          {
            "type": 3,
            "damage": 27
          },
          {
            "type": 4,
            "damage": 45
          }
        ],
        "image": "./agents/reyna.png"
      }
      
    ],
    
    "guns": {
      "primaryGun": [
        "./guns/gun6.png",
        "./guns/gun7.png",
        "./guns/gun8.png",
        "./guns/gun11.png",
        "./guns/gun12.png"
      ],
      "secondaryGun": [
        "./guns/gun14.png",
        "./guns/gun15.png",
        "./guns/gun13.png",
        "./guns/gun9.png",
        "./guns/gun10.png"
      ],
      "steel": [
        "./guns/gun1.png",
        "./guns/gun2.png",
        "./guns/gun3.png",
        "./guns/gun4.png",
        "./guns/gun5.png"
      ]
    },
    "maps": [
      "./maps/map1.png",
      "./maps/map2.png",
      "./maps/map3.png",
      "./maps/map4.png",
      "./maps/map5.png"
    ]
  }
}`;

//FIM DO JSON

var myData = JSON.parse(myJson);

var agents = myData.data.agents;



//CAPTURAR OS ELEMENTOS

var cardContainerElement = document.getElementById("cardContainer");
var modalBack = document.querySelector(".modal-back");
var closeModal = document.querySelector(".modal-close");
var modalBackNewAgent = document.querySelector(".modal-newAgent");
var closeModalNewAgent = document.querySelector(".modal-newAgent-close");
var closeModalBtnSave = document.querySelector(".closeModalBtnSave");
var addAgentButton = document.getElementById("addAgentButton");
var imageFile = null;

console.log("closeModalBtnSave");

function refreshAgentsList() {
cardContainerElement.innerHTML = "";
cardContainerElement.innerHTML += `<div class="newAgentCard">
    <img class="agentImage" src="images/Caminho 261.png"/>
    <h4><b>Adicionar</b></h4>
    </div>`;

agents.forEach(function (item, index /*, arr */) {
  //map é um loop que executa uma função pra cada item do array
  cardContainerElement.innerHTML += `
          <div class="agentCard" agent="${index}">
            <img class="agentImage" src="${item.image}"/>
            <h4>${item.name}</h4>
          </div>`;
});
var newAgentCard = document.querySelector(".newAgentCard");
newAgentCard.removeEventListener("click", function () {});
newAgentCard.addEventListener("click", function () {
  modalBackNewAgent.classList.add("bg-active");
});

document.querySelectorAll(".agentCard").forEach(function (item) {
  item.removeEventListener("click", function () {});
  item.addEventListener("click", (event) => {
    var functionField = document.getElementById("field-function");
    var descriptionField = document.getElementById("field-description");
    var primaryDmgField = document.getElementById("primary-dmg-field");
    var secondaryDmgField = document.getElementById("secondary-dmg-field");
    var meleeDmgField = document.getElementById("melee-dmg-field");
    var specialDmgField = document.getElementById("special-dmg-field");
    var agentImgElement = document.getElementById("agent-img-element");

    var agent = agents[item.getAttribute("agent")];

    functionField.innerHTML = agent.function;
    descriptionField.innerHTML = agent.description;
    primaryDmgField.innerHTML = agent.skills[0].damage + " Dano";
    secondaryDmgField.innerHTML = agent.skills[1].damage + " Dano";
    meleeDmgField.innerHTML = agent.skills[2].damage + " Dano";
    specialDmgField.innerHTML = agent.skills[3].damage + " Dano";
    modalBack.classList.add("bg-active");
    if (typeof agent.image === "string") {
      agentImgElement.src = agent.image;
    } else {
      agentImgElement.style.backgroundImage = `url('${imageFile}')`;
    }
  });
});
}

//EVENT LISTENERS
closeModal.addEventListener("click", function () {
modalBack.classList.remove("bg-active");
});

closeModalNewAgent.addEventListener("click", function () {
modalBackNewAgent.classList.remove("bg-active");
});





addAgentButton.addEventListener("click", function (e) {
var primaria = parseInt(document.getElementById("prymaryWeaponField").value);
var secundaria = parseInt(
  document.getElementById("secondaryWeaponField").value
);
var branca = parseInt(document.getElementById("meleeWeaponField").value);
var especial = parseInt(document.getElementById("specialField").value);

var nome = document.getElementById("nomeField").value;
var funcao = document.getElementById("functionSelect").value;
var descricao = document.getElementById("descriptionField").value;
//var imagem = parseInt(document.getElementById("specialField").value);


if (!nome.length) {
  alert("Escreva um nome");
  return;
}

if (!funcao.length) {
  alert("Selecione uma função");
  return;
}
if (!descricao.length) {
  alert("Escreva uma descrição");
  return;
}

if (isNaN(primaria) || primaria <= 0) {
  alert("Digite um valor numérico maior que zero para arma primária");
  return;
}

if (isNaN(secundaria) || secundaria <= 0) {
  alert("Digite um valor numérico maior que zero para arma secundária");
  return;
}
if (isNaN(branca) || branca <= 0) {
  alert("Digite um valor numérico maior que zero para arma branca");
  return;
}
if (isNaN(especial) || especial <= 0) {
  alert("Digite um valor numérico maior que zero para o especial");
  return;
}

if (!imageFile) {
  alert("adicione uma imagem");
  return;
}

var newAgent = {
  name: nome,
  function: funcao,
  description: descricao,
  skills: [
    {
      type: 1,
      damage: primaria,
    },
    {
      type: 2,
      damage: secundaria,
    },
    {
      type: 3,
      damage: branca,
    },
    {
      type: 4,
      damage: especial,
    },
  ],
  image: imageFile,
};
myData.data.agents.push(newAgent);
myJson = JSON.stringify(myData);

refreshAgentsList();
});

refreshAgentsList();

document.querySelectorAll(".drop-zone__input").forEach((inputElement) => {
const dropZoneElement = inputElement.closest(".drop-zone");

dropZoneElement.addEventListener("click", (e) => {
  inputElement.click();
});

inputElement.addEventListener("change", (e) => {
  if (inputElement.files.length) {
    updateThumbnail(dropZoneElement, inputElement.files[0]);
  }
});

dropZoneElement.addEventListener("dragover", (e) => {
  e.preventDefault();
  dropZoneElement.classList.add("drop-zone--over");
});

["dragleave", "dragend"].forEach((type) => {
  dropZoneElement.addEventListener(type, (e) => {
    dropZoneElement.classList.remove("drop-zone--over");
  });
});

dropZoneElement.addEventListener("drop", (e) => {
  e.preventDefault();

  if (e.dataTransfer.files.length) {
    inputElement.files = e.dataTransfer.files;
    updateThumbnail(dropZoneElement, e.dataTransfer.files[0]);
  }

  dropZoneElement.classList.remove("drop-zone--over");
});
});

function updateThumbnail(dropZoneElement, file) {
let thumbnailElement = dropZoneElement.querySelector(".drop-zone__thumb");

// First time - remove the prompt
if (dropZoneElement.querySelector(".drop-zone__prompt")) {
  dropZoneElement.querySelector(".drop-zone__prompt").remove();
}

// First time - there is no thumbnail element, so lets create it
if (!thumbnailElement) {
  thumbnailElement = document.createElement("div");
  thumbnailElement.classList.add("drop-zone__thumb");
  dropZoneElement.appendChild(thumbnailElement);
}

thumbnailElement.dataset.label = file.name;

// Show thumbnail for image files
if (file.type.startsWith("image/")) {
  const reader = new FileReader();

  reader.readAsDataURL(file);
  reader.onload = () => {
    thumbnailElement.style.backgroundImage = `url('${reader.result}')`;
    imageFile = reader.result;
  };
} else {
  thumbnailElement.style.backgroundImage = null;
  imageFile = null;
}
}


document.getElementById("addAgentButton").addEventListener("click", function(){
  modalBackNewAgent.classList.remove("bg-active");
});

document.getElementById("CancelAddAgentButton").addEventListener("click", function(){
  modalBackNewAgent.classList.remove("bg-active");
});